# vlm-coockiecutter
Cookiecutter template for personal Python Project
## Why a cookiecutter ?

[`cookiecutter`](https://github.com/cookiecutter/cookiecutter) is a Python utility that defines a relatively clean way to handle boilerplate files for new python repositories. </br>
The goal is to make project setup and Python configuration easy and fast to adopt for new projects, and possible to adopt for current projects.</br>

[`cruft`](https://github.com/cruft/cruft) is another Python utility dedicated to managing `cookiecutter` updates for new or existing projects. It works pretty well in most use cases, especially when you create the project directly with `cruft` so that the original `cookiecutter` template commit is saved when you generate you project.

<div id="create"></div>

## Creating the project with Cruft

- Create or simply activate a global virtual environment for the needed libraries (do not install them in a project environment) :

  ```bash
  python -m venv cookiecutter-env
  source cookiecutter-env/bin/activate
  pip install -U pip wheel setuptools
  pip install cookiecutter pyyaml cruft
  ```

- Use the GitHub repository via SSH :

  - Make sure you can log into GitHub via an SSH key
  - Activate the virtual environment mentioned in the first step
  - Change directory to the directory where you store your git repositories
  - Use the `cruft create` command by giving it the `vlm-cookiecutter` repository SSH link as template to use :

    ```bash
    cruft create git@github.com:vlemeur/vlm-coockiecutter.git
    ```

## CLI prompts

All fields with default values are optional, but it's highly recommended to update `package_name` at least.
Current variables, default values in parenthesis, a small description and recommended use :

- "author" ("Vincent LE MEUR") : author of the package, used in the `setup.cfg` metadata.
- "email" ("vincenlemeur@gmail.com") : email of the packahe maintainer/main contributor. Used for `setup.cfg` metadata.
- "project_folder" (`"vlm-cookiecutter"`) : used for the project folder (top folder generated). Recommended for GitHub repository name, but not compulsory.</br>
Using lower-case words separated with hyphen `"-"` and without whitespace is compulsory.</br>
**Warning** : `project_folder` is not compulsory for the GitHub repo name, but if you do change it then update the SonarCloud key in `sonar-project.properties`.
- "package_name" (`"{{ cookiecutter.project_folder.lower().replace(' ', '_').replace('-', '_') }}"`) : used for the resulting Python package. Using lower-case words separated with underscore `"_"` and without whitespace is compulsory.</br>
- "repository_url" (`"https://github.com/vlemeur/{{ cookiecutter.project_folder }}"`) : project url, default suggested url is built from `package_name` directly
- "project_short_description" ("Cookiecutter for Python projects") : used for the `setup.cfg` metadata and the `README.md`.
- "data_analysis" ("y"/"n") : used to create additional folders and files for client data analysis projects. Check out the complete list of added resources in [manifest.yml]({{cookiecutter.project_folder}}/manifest.yml).
- "check_dependencies_updates" ("y"/"n") : used to run an additional scheduled CI workflow against the latest dependencies available. Only interesting for libraries & services, not for data analysis customer projects. Allows you to check if the tests pass with the latest version of your logical dependencies and the linters pass with their latest version. Useful if you have any dependency with a greater (>= or >) version requirement or if you are looking to update and/or loosen your currently pinned/compatible (== or ~=) dependencies. Check out the complete list of added resources in [manifest.yml]({{cookiecutter.project_folder}}/manifest.yml).
- "documentation" ("y"/"n") : used to create necessary config to build and deploy (on release) documentation for the project. Check out the complete list of added resources in [manifest.yml]({{cookiecutter.project_folder}}/manifest.yml).
- "version" ("0.0.0") : starting version number, will be used in `setup.py`

Your project is ready to welcome and enhance your code, well done !

## Further necessary steps

Once you have created your package locally, a few steps remain that haven't been automated yet :

- Change directory into your newly created project : `cd cookiecutter.project_folder`
- You must have a working pip configuration under `~/.pip/pip.conf`
- It is recommended to use a virtualenv and pre-commit for your project:

  ```bash
  python -m venv venv
  source venv/bin/activate
  pip install -U pip

  pip install ".[tests,dev]"
  git init
  pre-commit install
  ```

- You must create a corresponding repository (matching `repository_url` if possible) on GitHub and push your local package as it was generated by the cookiecutter:
  Replace `**repository-url**` with the url chosen for your project repository.
  ```bash
  git remote add origin https://github.com/vlemeur/**repository-url**
  git add .
  git commit -m "Initial Commit. Project generated using vlm-cookiecutter"
  ```

- If you have opted for the `documentation` optional feature at project creation
  - Make sure your docstrings comply with [NumpyDoc](https://numpydoc.readthedocs.io/en/latest/format.html) and cover most of the code.
  - Add your modules to the generated project's reference file at : `{{cookiecutter.project_folder}}/docs/reference.rst`.
  - Look in the generated project's `README.md`

## Updating your project to the latest `vlm-cookiecutter` version

### Project not created with `vlm-cookiecutter`

There is no ideal way to deal with this, especially since the early commit history of `vlm-cookiecutter` was not designed with this use case in mind. </br>
The currently recommended way to deal with this (may change in the future) :

- Clone locally the repository you want to use the cookiecutter with
- Step into the project folder
- Execute the steps defined in [Creating the project with Cruft](#create).
  Yes, this will create a subfolder with the same name of your project folder.
- The following steps are mostly of the copy/paste kind (not optimal), but at least you have the latest cookiecutter generated files with you project name in them and the old files close to each other for comparison.
- Pay attention of the `install-requires` section in the newly generated `setup.cfg` : the logical dependencies of your project were either declared in `setup.py` (old version) or in `requirements.txt` (old version)
- Since all the valuable information in `setup.py` (old version) is prompted for by the cookiecutter or has now been picked up manually, you can replace it.
- Manually manage the conflicts between old and new `README.md`.
- Most other files should be entirely new and should not create any issues.
- If you find a better workflow to rebase an existing project created without cookiecutter on the latest cookiecuter version, please inform the team.

### Project created with `vlm-cookiecutter-python` but without `cruft`

- Link your project to the `vlm-cookiecutter-python` GitHub repository via SSH (use HTTPS if you haven't configured SSH) :

  ```bash
  cruft link git@github.com:vlemeur/vlm-coockiecutter.git
  ```

- You will be prompted to re-enter the cookiecutter variables, and eventually new ones (added to the cookiecutter since you first used it).
  Pay attention to the details, as these variables will be used to generate the cookiecutter again, compare the diff with your version, and apply the diff if you agree.
- Be careful : `cruft` will also prompt you for a commit number, it is the commit SHA corresponding to the version of `vlm-cookiecutter-python` you used to generate your project. Look at the date you first created your project and check the corresponding `vlm-cookiecutter-python` commit in the [history](https://github.com/vlemeur/vlm-coockiecutter/commits/main).
- When you are done with providing the commit number, `cruft` will generate a `.cruft.json` file to store all these cookiecutter variables for next time. It is recommended to add this file to version control and commit it on its own before you apply updates to your project.
- You can now follow the same procedure (described below) as project created with `cruft`.

### Project created with `cruft`

- Check for updates :

  ```bash
  cruft check
  ```

- Check the content of the updates before applying it :

  ```bash
  cruft diff
  ```

- Apply all the updates if you think it's worthwhile :

  ```bash
  cruft update
  y # you will be prompted for input after the first command, y is for yes
  ```

- Apply all the updates and add optional cookiecutter features :

  ```bash
  cruft update -i
  # You will be prompted for the cookiecutter arguments and you will be able to change value for new optional ones
  ```

### Dealing with `cruft update` conflicts :

To work its magic, `cruft` uses 2 temporary folders : one created with the latest version of `vlm-cookiecutter`, one with the version of `vlm-cookiecutter` you created you project with (from the commit SHA that you provided via CLI or edited at `.cruft.json`).
The diff is performed between those 2 git repositories, and applied with `git apply` to you current repository.
Issues may arise if you :

- provided a `vlm-cookiecutter` project commit that does not correspond exactly to the `vlm-cookiecutter` version you used to generate your project.
- you have updated/modified files on specific lines where there is a `vlm-cookiecutter` diff.
  The outcome may be a bunch of `.rej` files (git rejection files, generated from the `apply`). If you would rather have conflicts directly in the affected files, so that you can resolve by hand with VScode fore example, use `cruft < 1.4` because it doesn't use `git apply` but `git patch`.
  To know more about this issue, and to check if the project has found a better way of handling these painful conflicts, check the [dedicated issue on GitHub](https://github.com/cruft/cruft/issues/49)

## Current Features

- Modern project setup with `setup.cfg` and `pyproject.toml`
- Python interpreters : By default, Python 3.7, Python 3.8 and Python 3.9 will be used to test your code.
- Linters : `black`, `bandit`, `isort`, `flake8`, `pylint` and `mypy`.
- Spell checking for code, comments and docstrings via `pyenchant`.
- Test suite : tox and pytest
- Pre-commit hooks : file formatters and linters run with `tox`
- GitHub CI/CD : tests and linters are run automatically on every push
- GitHub issues and PR templates
- Additional files and tox commands for data analysis projects
- Build documentation with Sphinx
